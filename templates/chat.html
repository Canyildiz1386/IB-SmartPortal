{% extends "base.html" %}
{% block title %}AI Chat - Smart Study{% endblock %}
{% block content %}
<h2>AI Chat</h2>
<div class="card">
    <div class="card-body">
        <div id="chatMessages" style="height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; background: #f9f9f9;">
            {% for msg in chat_history %}
            <div class="mb-3">
                <strong>You:</strong> {{ msg.question }}<br>
                <strong>AI:</strong> {{ msg.answer }}
            </div>
            {% endfor %}
        </div>
        <form method="POST" id="chatForm">
            <div class="input-group">
                <input type="text" name="question" class="form-control" placeholder="Ask a question..." required>
                <button type="submit" class="btn btn-primary">Send</button>
            </div>
        </form>
    </div>
</div>
<script>
document.getElementById('chatForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const question = formData.get('question');
    const messagesDiv = document.getElementById('chatMessages');
    messagesDiv.innerHTML += '<div class="mb-3"><strong>You:</strong> ' + question + '</div>';
    this.querySelector('input').value = '';
    fetch('/chat', {
        method: 'POST',
        headers: {'X-Requested-With': 'XMLHttpRequest'},
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            messagesDiv.innerHTML += '<div class="mb-3"><strong>AI:</strong> ' + data.answer + '</div>';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        } else {
            alert('Error: ' + data.error);
        }
    });
});
</script>
{% endblock %}
