<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}IB Study Portal{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white min-h-screen">
    <nav class="bg-gray-800/90 backdrop-blur-sm shadow-xl border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-8">
                    <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">IB Study Portal</h1>
                    {% if session.user_id %}
                        <div class="hidden md:flex items-center space-x-6">
                            {% if session.role != 'student' %}
                                <a href="{{ url_for('upload') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Upload</a>
                            {% endif %}
                            <a href="{{ url_for('chat') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Chat</a>
                            {% if session.role != 'admin' %}
                                <a href="{{ url_for('subjects') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Subjects</a>
                            {% endif %}
                            {% if session.role == 'student' %}
                                <a href="{{ url_for('student_quizzes') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">My Quizzes</a>
                            {% elif session.role == 'teacher' %}
                                <a href="{{ url_for('create_quiz_route') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Create Quiz</a>
                                <a href="{{ url_for('my_quizzes') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">My Quizzes</a>
                            {% endif %}
                            {% if session.role in ['admin', 'teacher'] %}
                                <a href="{{ url_for('dashboard') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Dashboard</a>
                            {% endif %}
                            {% if session.role == 'admin' %}
                                <a href="{{ url_for('admin') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Admin</a>
                                <a href="{{ url_for('manage_subjects') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Subjects</a>
                            {% endif %}
                            {% if session.role in ['admin', 'teacher'] %}
                                <a href="{{ url_for('progress') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Progress</a>
                            {% endif %}
                            <a href="{{ url_for('profile') }}" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Profile</a>
                            <button onclick="showGuide()" class="text-gray-300 hover:text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-gray-700">Help</button>
                        </div>
                    {% endif %}
                </div>
                <div class="flex items-center space-x-4">
                    {% if session.user_id %}
                        <div class="hidden sm:block">
                            <span class="text-gray-300 text-sm bg-gray-700 px-3 py-1 rounded-full">{{ session.username }} ({{ session.role }})</span>
                        </div>
                        <a href="{{ url_for('logout') }}" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105">Logout</a>
                    {% else %}
                        <a href="{{ url_for('login') }}" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all transform hover:scale-105">Login</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="max-w-7xl mx-auto px-4 py-3">
                {% for category, message in messages %}
                    <div class="bg-{{ 'red' if category == 'error' else 'green' }}-600/90 backdrop-blur-sm text-white px-4 py-3 rounded-lg mb-3 text-sm font-medium shadow-lg border border-{{ 'red' if category == 'error' else 'green' }}-500/20">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <main class="max-w-7xl mx-auto px-4 py-8">
        {% block content %}{% endblock %}
    </main>

    <!-- Guide Modals -->
    <div id="guideModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-gray-800 border-b border-gray-700 p-6 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-blue-400">Welcome to IB Study Portal!</h2>
                <button onclick="closeGuide()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="p-6">
                <div id="studentGuide" class="hidden">
                    <div class="space-y-6">
                        <div class="bg-gray-700/50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4 text-white">üìö Getting Started</h3>
                            <div class="text-gray-300 space-y-3">
                                <p>Welcome! As a student, you can:</p>
                                <ul class="list-disc list-inside space-y-2 ml-4">
                                    <li>Take quizzes assigned by your teachers</li>
                                    <li>Ask questions about your study materials</li>
                                    <li>View your quiz results and progress</li>
                                    <li>Access materials uploaded by teachers</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-gray-700/50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4 text-white">üìù Taking Quizzes</h3>
                            <div class="text-gray-300 space-y-3">
                                <p><strong>Step 1:</strong> Go to "My Quizzes" to see assigned quizzes</p>
                                <p><strong>Step 2:</strong> Click on a quiz to start taking it</p>
                                <p><strong>Step 3:</strong> Read each question carefully and select your answer</p>
                                <p><strong>Step 4:</strong> Click "Submit Quiz" when you're done</p>
                                <p><strong>Step 5:</strong> View your results and feedback</p>
                                <div class="bg-blue-600/20 border border-blue-500/30 rounded-lg p-4 mt-4">
                                    <p class="text-blue-400"><strong>üí° Tip:</strong> Make sure to answer all questions before submitting!</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-700/50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4 text-white">üí¨ Asking Questions</h3>
                            <div class="text-gray-300 space-y-3">
                                <p><strong>Step 1:</strong> Go to "Chat" in the navigation</p>
                                <p><strong>Step 2:</strong> Type your question about the study materials</p>
                                <p><strong>Step 3:</strong> Wait for the AI to process your question</p>
                                <p><strong>Step 4:</strong> Read the detailed answer provided</p>
                                <div class="bg-green-600/20 border border-green-500/30 rounded-lg p-4 mt-4">
                                    <p class="text-green-400"><strong>üí° Tip:</strong> Ask specific questions for better answers!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="teacherGuide" class="hidden">
                    <div class="space-y-6">
                        <div class="bg-gray-700/50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4 text-white">üë®‚Äçüè´ Getting Started</h3>
                            <div class="text-gray-300 space-y-3">
                                <p>Welcome! As a teacher, you can:</p>
                                <ul class="list-disc list-inside space-y-2 ml-4">
                                    <li>Upload study materials (PDFs and text files)</li>
                                    <li>Create quizzes for your students</li>
                                    <li>Assign quizzes to specific students</li>
                                    <li>Monitor student progress and performance</li>
                                    <li>Answer student questions through the AI system</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-gray-700/50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4 text-white">üìö Uploading Materials</h3>
                            <div class="text-gray-300 space-y-3">
                                <p><strong>Step 1:</strong> Go to "Upload" in the navigation</p>
                                <p><strong>Step 2:</strong> Select the subject for your materials</p>
                                <p><strong>Step 3:</strong> Choose PDF or TXT files to upload</p>
                                <p><strong>Step 4:</strong> Click "Upload & Index" to process the files</p>
                                <p><strong>Step 5:</strong> Wait for the AI to analyze and index the content</p>
                                <div class="bg-blue-600/20 border border-blue-500/30 rounded-lg p-4 mt-4">
                                    <p class="text-blue-400"><strong>üí° Tip:</strong> Upload materials by subject for better organization!</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-700/50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4 text-white">üìù Creating Quizzes</h3>
                            <div class="text-gray-300 space-y-3">
                                <p><strong>Step 1:</strong> Go to "Create Quiz" in the navigation</p>
                                <p><strong>Step 2:</strong> Enter a quiz title</p>
                                <p><strong>Step 3:</strong> Select the subject for the quiz</p>
                                <p><strong>Step 4:</strong> Write a description of what the quiz should cover</p>
                                <p><strong>Step 5:</strong> Choose the number of questions (3, 5, or 10)</p>
                                <p><strong>Step 6:</strong> Click "Create Quiz" and wait for AI generation</p>
                                <p><strong>Step 7:</strong> Assign the quiz to specific students</p>
                                <div class="bg-green-600/20 border border-green-500/30 rounded-lg p-4 mt-4">
                                    <p class="text-green-400"><strong>üí° Tip:</strong> Be specific in your description for better quiz questions!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="adminGuide" class="hidden">
                    <div class="space-y-6">
                        <div class="bg-gray-700/50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4 text-white">üëë Admin Overview</h3>
                            <div class="text-gray-300 space-y-3">
                                <p>As an admin, you have full control over the IB Study Portal:</p>
                                <ul class="list-disc list-inside space-y-2 ml-4">
                                    <li>Manage all users (students, teachers, admins)</li>
                                    <li>Create and manage subjects</li>
                                    <li>Upload materials for any subject</li>
                                    <li>View system-wide analytics and reports</li>
                                    <li>Monitor all user activity and progress</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-gray-700/50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4 text-white">üë• User Management</h3>
                            <div class="text-gray-300 space-y-3">
                                <p><strong>Creating Users:</strong></p>
                                <ul class="list-disc list-inside space-y-2 ml-4">
                                    <li>Go to "Admin" in the navigation</li>
                                    <li>Enter username and password</li>
                                    <li>Select role (Student, Teacher, or Admin)</li>
                                    <li>Assign subjects for students and teachers</li>
                                    <li>Click "Add User"</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-gray-700/50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold mb-4 text-white">üìö Subject Management</h3>
                            <div class="text-gray-300 space-y-3">
                                <p><strong>Creating Subjects:</strong></p>
                                <ul class="list-disc list-inside space-y-2 ml-4">
                                    <li>Go to "Subjects" in the navigation</li>
                                    <li>Enter subject name (e.g., Mathematics, Physics)</li>
                                    <li>Click "Add Subject"</li>
                                </ul>
                                <div class="bg-blue-600/20 border border-blue-500/30 rounded-lg p-4 mt-4">
                                    <p class="text-blue-400"><strong>üí° Tip:</strong> Create subjects that match your IBDP curriculum!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sticky bottom-0 bg-gray-800 border-t border-gray-700 p-6 flex justify-between">
                <label class="flex items-center text-gray-300">
                    <input type="checkbox" id="dontShowAgain" class="mr-2">
                    Don't show this guide again
                </label>
                <button onclick="closeGuide()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">Got it!</button>
            </div>
        </div>
    </div>

    <script>
        function showGuide() {
            const modal = document.getElementById('guideModal');
            const role = '{{ session.role }}';
            
            // Hide all guides
            document.getElementById('studentGuide').classList.add('hidden');
            document.getElementById('teacherGuide').classList.add('hidden');
            document.getElementById('adminGuide').classList.add('hidden');
            
            // Show appropriate guide
            if (role === 'student') {
                document.getElementById('studentGuide').classList.remove('hidden');
            } else if (role === 'teacher') {
                document.getElementById('teacherGuide').classList.remove('hidden');
            } else if (role === 'admin') {
                document.getElementById('adminGuide').classList.remove('hidden');
            }
            
            modal.classList.remove('hidden');
        }

        function closeGuide() {
            const modal = document.getElementById('guideModal');
            const dontShowAgain = document.getElementById('dontShowAgain').checked;
            
            if (dontShowAgain) {
                localStorage.setItem('guideShown', 'true');
            }
            
            modal.classList.add('hidden');
        }

        // Show guide for first-time users
        document.addEventListener('DOMContentLoaded', function() {
            const guideShown = localStorage.getItem('guideShown');
            if (!guideShown) {
                setTimeout(showGuide, 1000); // Show after 1 second
            }
        });
    </script>
</body>
</html>
